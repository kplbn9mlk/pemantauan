<?php
// This script and data application were generated by AppGini 5.97
// Download AppGini for free from https://bigprof.com/appgini/download/

	/* Configuration */
	/*************************************/

		$pcConfig = [
			'jpd_de' => [
			],
			'pams_DE' => [
			],
			'JL' => [
			],
			'jpd_khas' => [
				'Kelulusan' => [
					'parent-table' => 'kelulusan',
					'parent-primary-key' => 'id',
					'child-primary-key' => 'ID',
					'child-primary-key-index' => 0,
					'tab-label' => 'JPD PRE <span class="hidden child-label-jpd_khas child-field-caption">(Kelulusan)</span>',
					'auto-close' => false,
					'table-icon' => 'resources/table_icons/car.png',
					'display-refresh' => true,
					'display-add-new' => true,
					'forced-where' => '',
					'display-fields' => array(1 => 'Tahun laksana', 2 => 'Sumber Peruntukan', 3 => 'Kelulusan', 4 => 'Nama Projek', 5 => 'Negeri', 6 => 'Daerah', 7 => 'Parlimen', 8 => 'DUN', 11 => 'Nama Kontraktor', 12 => 'Tarikh SST ', 14 => 'Tarikh Siap Sebenar', 15 => 'Panjang Jalan (M)', 16 => 'Lebar (M)', 17 => 'Skop Kerja', 18 => 'Gambar ', 20 => 'Peta', 21 => 'Peruntukan Diluluskan', 23 => 'Kos projek', 24 => 'KKSVO', 25 => 'Perbelanjaan', 26 => 'penjimatan', 27 => 'Status', 28 => 'Penyelia projek', 29 => 'Penerima Manfaat', 31 => 'Catatan', 32 => 'Inden Kerja', 33 => 'Baucer Bayaran', 34 => 'Gambar   ', 35 => 'Gambar projek', 36 => 'Dikemaskini Oleh'),
					'display-field-names' => array(1 => 'tahun_laksana', 2 => 'Waran', 3 => 'Kelulusan', 4 => 'NamaProjek', 5 => 'negeri', 6 => 'Daerah', 7 => 'Parlimen', 8 => 'DUN', 11 => 'NamaKontraktor', 12 => 'TarikhSST', 14 => 'TarikhSiapsebenar', 15 => 'PanjangJalanM', 16 => 'LebarM', 17 => 'skop', 18 => 'gambar_projek', 20 => 'Peta', 21 => 'PeruntukanDiluluskan', 23 => 'Kosprojek', 24 => 'KKSVO', 25 => 'Perbelanjaan', 26 => 'penjimatan', 27 => 'Status', 28 => 'penyelia_projek', 29 => 'PenerimaManfaat', 31 => 'catatan', 32 => 'inden', 33 => 'Baucer', 34 => 'gambar_projek_1', 35 => 'gambar_projek_2', 36 => 'updated'),
					'sortable-fields' => array(0 => '`jpd_khas`.`ID`', 1 => '`tahun1`.`tahun`', 2 => '`waran1`.`sumber_waran`', 3 => '`kelulusan1`.`kelulusan_jawatankuasa`', 4 => 5, 5 => '`negeri1`.`nama_negeri`', 6 => '`daerah1`.`nama_daerah`', 7 => '`PARLIMEN1`.`nama_parlimen`', 8 => '`Dun1`.`nama_dun`', 9 => '`agensi_pelaksana1`.`pelaksana`', 10 => '`agensi_bayar1`.`agensi`', 11 => 12, 12 => '`jpd_khas`.`TarikhSST`', 13 => '`jpd_khas`.`TarikhSiapProjek`', 14 => 15, 15 => '`jpd_khas`.`PanjangJalanM`', 16 => 17, 17 => '`skop_jpd1`.`skop_jpd`', 18 => 19, 19 => 20, 20 => 21, 21 => '`jpd_khas`.`PeruntukanDiluluskan`', 22 => '`jpd_khas`.`peruntukan_dipinda`', 23 => '`jpd_khas`.`Kosprojek`', 24 => '`jpd_khas`.`KKSVO`', 25 => '`jpd_khas`.`Perbelanjaan`', 26 => '`jpd_khas`.`penjimatan`', 27 => '`status_pelaksanaan1`.`status_laksana`', 28 => '`penyelia_projek1`.`nama_penyelia`', 29 => 30, 30 => 31, 31 => 32, 32 => 33, 33 => 34, 34 => 35, 35 => 36, 36 => 37),
					'records-per-page' => 10,
					'default-sort-by' => 0,
					'default-sort-direction' => 'asc',
					'open-detail-view-on-click' => true,
					'display-page-selector' => true,
					'show-page-progress' => true,
					'template' => 'children-jpd_khas',
					'template-printable' => 'children-jpd_khas-printable',
					'query' => "SELECT `jpd_khas`.`ID` as 'ID', IF(    CHAR_LENGTH(`tahun1`.`tahun`), CONCAT_WS('',   `tahun1`.`tahun`), '') as 'tahun_laksana', IF(    CHAR_LENGTH(`waran1`.`sumber_waran`), CONCAT_WS('',   `waran1`.`sumber_waran`), '') as 'Waran', IF(    CHAR_LENGTH(`kelulusan1`.`kelulusan_jawatankuasa`), CONCAT_WS('',   `kelulusan1`.`kelulusan_jawatankuasa`), '') as 'Kelulusan', `jpd_khas`.`NamaProjek` as 'NamaProjek', IF(    CHAR_LENGTH(`negeri1`.`nama_negeri`), CONCAT_WS('',   `negeri1`.`nama_negeri`), '') as 'negeri', IF(    CHAR_LENGTH(`daerah1`.`nama_daerah`), CONCAT_WS('',   `daerah1`.`nama_daerah`), '') as 'Daerah', IF(    CHAR_LENGTH(`PARLIMEN1`.`nama_parlimen`), CONCAT_WS('',   `PARLIMEN1`.`nama_parlimen`), '') as 'Parlimen', IF(    CHAR_LENGTH(`Dun1`.`nama_dun`), CONCAT_WS('',   `Dun1`.`nama_dun`), '') as 'DUN', IF(    CHAR_LENGTH(`agensi_pelaksana1`.`pelaksana`), CONCAT_WS('',   `agensi_pelaksana1`.`pelaksana`), '') as 'AgensiPelaksana', IF(    CHAR_LENGTH(`agensi_bayar1`.`agensi`), CONCAT_WS('',   `agensi_bayar1`.`agensi`), '') as 'agensi_pembayar', `jpd_khas`.`NamaKontraktor` as 'NamaKontraktor', if(`jpd_khas`.`TarikhSST`,date_format(`jpd_khas`.`TarikhSST`,'%d/%m/%Y'),'') as 'TarikhSST', if(`jpd_khas`.`TarikhSiapProjek`,date_format(`jpd_khas`.`TarikhSiapProjek`,'%d/%m/%Y'),'') as 'TarikhSiapProjek', `jpd_khas`.`TarikhSiapsebenar` as 'TarikhSiapsebenar', `jpd_khas`.`PanjangJalanM` as 'PanjangJalanM', `jpd_khas`.`LebarM` as 'LebarM', IF(    CHAR_LENGTH(`skop_jpd1`.`skop_jpd`), CONCAT_WS('',   `skop_jpd1`.`skop_jpd`), '') as 'skop', `jpd_khas`.`gambar_projek` as 'gambar_projek', `jpd_khas`.`Latitud` as 'Latitud', `jpd_khas`.`Peta` as 'Peta', FORMAT(`jpd_khas`.`PeruntukanDiluluskan`, 2) as 'PeruntukanDiluluskan', `jpd_khas`.`peruntukan_dipinda` as 'peruntukan_dipinda', FORMAT(`jpd_khas`.`Kosprojek`, 2) as 'Kosprojek', FORMAT(`jpd_khas`.`KKSVO`, 2) as 'KKSVO', `jpd_khas`.`Perbelanjaan` as 'Perbelanjaan', `jpd_khas`.`penjimatan` as 'penjimatan', IF(    CHAR_LENGTH(`status_pelaksanaan1`.`status_laksana`), CONCAT_WS('',   `status_pelaksanaan1`.`status_laksana`), '') as 'Status', IF(    CHAR_LENGTH(`penyelia_projek1`.`nama_penyelia`), CONCAT_WS('',   `penyelia_projek1`.`nama_penyelia`), '') as 'penyelia_projek', `jpd_khas`.`PenerimaManfaat` as 'PenerimaManfaat', `jpd_khas`.`sumber_permohonan` as 'sumber_permohonan', `jpd_khas`.`catatan` as 'catatan', `jpd_khas`.`inden` as 'inden', `jpd_khas`.`Baucer` as 'Baucer', `jpd_khas`.`gambar_projek_1` as 'gambar_projek_1', `jpd_khas`.`gambar_projek_2` as 'gambar_projek_2', `jpd_khas`.`updated` as 'updated' FROM `jpd_khas` LEFT JOIN `tahun` as tahun1 ON `tahun1`.`id`=`jpd_khas`.`tahun_laksana` LEFT JOIN `waran` as waran1 ON `waran1`.`id`=`jpd_khas`.`Waran` LEFT JOIN `kelulusan` as kelulusan1 ON `kelulusan1`.`id`=`jpd_khas`.`Kelulusan` LEFT JOIN `negeri` as negeri1 ON `negeri1`.`id`=`jpd_khas`.`negeri` LEFT JOIN `daerah` as daerah1 ON `daerah1`.`id`=`jpd_khas`.`Daerah` LEFT JOIN `PARLIMEN` as PARLIMEN1 ON `PARLIMEN1`.`id`=`jpd_khas`.`Parlimen` LEFT JOIN `Dun` as Dun1 ON `Dun1`.`id`=`jpd_khas`.`DUN` LEFT JOIN `agensi_pelaksana` as agensi_pelaksana1 ON `agensi_pelaksana1`.`id`=`jpd_khas`.`AgensiPelaksana` LEFT JOIN `agensi_bayar` as agensi_bayar1 ON `agensi_bayar1`.`id`=`jpd_khas`.`agensi_pembayar` LEFT JOIN `skop_jpd` as skop_jpd1 ON `skop_jpd1`.`id`=`jpd_khas`.`skop` LEFT JOIN `status_pelaksanaan` as status_pelaksanaan1 ON `status_pelaksanaan1`.`id`=`jpd_khas`.`Status` LEFT JOIN `penyelia_projek` as penyelia_projek1 ON `penyelia_projek1`.`id`=`jpd_khas`.`penyelia_projek` "
				],
				'AgensiPelaksana' => [
					'parent-table' => 'agensi_pelaksana',
					'parent-primary-key' => 'id',
					'child-primary-key' => 'ID',
					'child-primary-key-index' => 0,
					'tab-label' => 'JPD PRE <span class="hidden child-label-jpd_khas child-field-caption">(Agensi Pelaksana)</span>',
					'auto-close' => false,
					'table-icon' => 'resources/table_icons/car.png',
					'display-refresh' => true,
					'display-add-new' => true,
					'forced-where' => '',
					'display-fields' => array(1 => 'Tahun laksana', 2 => 'Sumber Peruntukan', 3 => 'Kelulusan', 4 => 'Nama Projek', 5 => 'Negeri', 6 => 'Daerah', 7 => 'Parlimen', 8 => 'DUN', 11 => 'Nama Kontraktor', 12 => 'Tarikh SST ', 14 => 'Tarikh Siap Sebenar', 15 => 'Panjang Jalan (M)', 16 => 'Lebar (M)', 17 => 'Skop Kerja', 18 => 'Gambar ', 20 => 'Peta', 21 => 'Peruntukan Diluluskan', 23 => 'Kos projek', 24 => 'KKSVO', 25 => 'Perbelanjaan', 26 => 'penjimatan', 27 => 'Status', 28 => 'Penyelia projek', 29 => 'Penerima Manfaat', 31 => 'Catatan', 32 => 'Inden Kerja', 33 => 'Baucer Bayaran', 34 => 'Gambar   ', 35 => 'Gambar projek', 36 => 'Dikemaskini Oleh'),
					'display-field-names' => array(1 => 'tahun_laksana', 2 => 'Waran', 3 => 'Kelulusan', 4 => 'NamaProjek', 5 => 'negeri', 6 => 'Daerah', 7 => 'Parlimen', 8 => 'DUN', 11 => 'NamaKontraktor', 12 => 'TarikhSST', 14 => 'TarikhSiapsebenar', 15 => 'PanjangJalanM', 16 => 'LebarM', 17 => 'skop', 18 => 'gambar_projek', 20 => 'Peta', 21 => 'PeruntukanDiluluskan', 23 => 'Kosprojek', 24 => 'KKSVO', 25 => 'Perbelanjaan', 26 => 'penjimatan', 27 => 'Status', 28 => 'penyelia_projek', 29 => 'PenerimaManfaat', 31 => 'catatan', 32 => 'inden', 33 => 'Baucer', 34 => 'gambar_projek_1', 35 => 'gambar_projek_2', 36 => 'updated'),
					'sortable-fields' => array(0 => '`jpd_khas`.`ID`', 1 => '`tahun1`.`tahun`', 2 => '`waran1`.`sumber_waran`', 3 => '`kelulusan1`.`kelulusan_jawatankuasa`', 4 => 5, 5 => '`negeri1`.`nama_negeri`', 6 => '`daerah1`.`nama_daerah`', 7 => '`PARLIMEN1`.`nama_parlimen`', 8 => '`Dun1`.`nama_dun`', 9 => '`agensi_pelaksana1`.`pelaksana`', 10 => '`agensi_bayar1`.`agensi`', 11 => 12, 12 => '`jpd_khas`.`TarikhSST`', 13 => '`jpd_khas`.`TarikhSiapProjek`', 14 => 15, 15 => '`jpd_khas`.`PanjangJalanM`', 16 => 17, 17 => '`skop_jpd1`.`skop_jpd`', 18 => 19, 19 => 20, 20 => 21, 21 => '`jpd_khas`.`PeruntukanDiluluskan`', 22 => '`jpd_khas`.`peruntukan_dipinda`', 23 => '`jpd_khas`.`Kosprojek`', 24 => '`jpd_khas`.`KKSVO`', 25 => '`jpd_khas`.`Perbelanjaan`', 26 => '`jpd_khas`.`penjimatan`', 27 => '`status_pelaksanaan1`.`status_laksana`', 28 => '`penyelia_projek1`.`nama_penyelia`', 29 => 30, 30 => 31, 31 => 32, 32 => 33, 33 => 34, 34 => 35, 35 => 36, 36 => 37),
					'records-per-page' => 10,
					'default-sort-by' => 0,
					'default-sort-direction' => 'asc',
					'open-detail-view-on-click' => true,
					'display-page-selector' => true,
					'show-page-progress' => true,
					'template' => 'children-jpd_khas',
					'template-printable' => 'children-jpd_khas-printable',
					'query' => "SELECT `jpd_khas`.`ID` as 'ID', IF(    CHAR_LENGTH(`tahun1`.`tahun`), CONCAT_WS('',   `tahun1`.`tahun`), '') as 'tahun_laksana', IF(    CHAR_LENGTH(`waran1`.`sumber_waran`), CONCAT_WS('',   `waran1`.`sumber_waran`), '') as 'Waran', IF(    CHAR_LENGTH(`kelulusan1`.`kelulusan_jawatankuasa`), CONCAT_WS('',   `kelulusan1`.`kelulusan_jawatankuasa`), '') as 'Kelulusan', `jpd_khas`.`NamaProjek` as 'NamaProjek', IF(    CHAR_LENGTH(`negeri1`.`nama_negeri`), CONCAT_WS('',   `negeri1`.`nama_negeri`), '') as 'negeri', IF(    CHAR_LENGTH(`daerah1`.`nama_daerah`), CONCAT_WS('',   `daerah1`.`nama_daerah`), '') as 'Daerah', IF(    CHAR_LENGTH(`PARLIMEN1`.`nama_parlimen`), CONCAT_WS('',   `PARLIMEN1`.`nama_parlimen`), '') as 'Parlimen', IF(    CHAR_LENGTH(`Dun1`.`nama_dun`), CONCAT_WS('',   `Dun1`.`nama_dun`), '') as 'DUN', IF(    CHAR_LENGTH(`agensi_pelaksana1`.`pelaksana`), CONCAT_WS('',   `agensi_pelaksana1`.`pelaksana`), '') as 'AgensiPelaksana', IF(    CHAR_LENGTH(`agensi_bayar1`.`agensi`), CONCAT_WS('',   `agensi_bayar1`.`agensi`), '') as 'agensi_pembayar', `jpd_khas`.`NamaKontraktor` as 'NamaKontraktor', if(`jpd_khas`.`TarikhSST`,date_format(`jpd_khas`.`TarikhSST`,'%d/%m/%Y'),'') as 'TarikhSST', if(`jpd_khas`.`TarikhSiapProjek`,date_format(`jpd_khas`.`TarikhSiapProjek`,'%d/%m/%Y'),'') as 'TarikhSiapProjek', `jpd_khas`.`TarikhSiapsebenar` as 'TarikhSiapsebenar', `jpd_khas`.`PanjangJalanM` as 'PanjangJalanM', `jpd_khas`.`LebarM` as 'LebarM', IF(    CHAR_LENGTH(`skop_jpd1`.`skop_jpd`), CONCAT_WS('',   `skop_jpd1`.`skop_jpd`), '') as 'skop', `jpd_khas`.`gambar_projek` as 'gambar_projek', `jpd_khas`.`Latitud` as 'Latitud', `jpd_khas`.`Peta` as 'Peta', FORMAT(`jpd_khas`.`PeruntukanDiluluskan`, 2) as 'PeruntukanDiluluskan', `jpd_khas`.`peruntukan_dipinda` as 'peruntukan_dipinda', FORMAT(`jpd_khas`.`Kosprojek`, 2) as 'Kosprojek', FORMAT(`jpd_khas`.`KKSVO`, 2) as 'KKSVO', `jpd_khas`.`Perbelanjaan` as 'Perbelanjaan', `jpd_khas`.`penjimatan` as 'penjimatan', IF(    CHAR_LENGTH(`status_pelaksanaan1`.`status_laksana`), CONCAT_WS('',   `status_pelaksanaan1`.`status_laksana`), '') as 'Status', IF(    CHAR_LENGTH(`penyelia_projek1`.`nama_penyelia`), CONCAT_WS('',   `penyelia_projek1`.`nama_penyelia`), '') as 'penyelia_projek', `jpd_khas`.`PenerimaManfaat` as 'PenerimaManfaat', `jpd_khas`.`sumber_permohonan` as 'sumber_permohonan', `jpd_khas`.`catatan` as 'catatan', `jpd_khas`.`inden` as 'inden', `jpd_khas`.`Baucer` as 'Baucer', `jpd_khas`.`gambar_projek_1` as 'gambar_projek_1', `jpd_khas`.`gambar_projek_2` as 'gambar_projek_2', `jpd_khas`.`updated` as 'updated' FROM `jpd_khas` LEFT JOIN `tahun` as tahun1 ON `tahun1`.`id`=`jpd_khas`.`tahun_laksana` LEFT JOIN `waran` as waran1 ON `waran1`.`id`=`jpd_khas`.`Waran` LEFT JOIN `kelulusan` as kelulusan1 ON `kelulusan1`.`id`=`jpd_khas`.`Kelulusan` LEFT JOIN `negeri` as negeri1 ON `negeri1`.`id`=`jpd_khas`.`negeri` LEFT JOIN `daerah` as daerah1 ON `daerah1`.`id`=`jpd_khas`.`Daerah` LEFT JOIN `PARLIMEN` as PARLIMEN1 ON `PARLIMEN1`.`id`=`jpd_khas`.`Parlimen` LEFT JOIN `Dun` as Dun1 ON `Dun1`.`id`=`jpd_khas`.`DUN` LEFT JOIN `agensi_pelaksana` as agensi_pelaksana1 ON `agensi_pelaksana1`.`id`=`jpd_khas`.`AgensiPelaksana` LEFT JOIN `agensi_bayar` as agensi_bayar1 ON `agensi_bayar1`.`id`=`jpd_khas`.`agensi_pembayar` LEFT JOIN `skop_jpd` as skop_jpd1 ON `skop_jpd1`.`id`=`jpd_khas`.`skop` LEFT JOIN `status_pelaksanaan` as status_pelaksanaan1 ON `status_pelaksanaan1`.`id`=`jpd_khas`.`Status` LEFT JOIN `penyelia_projek` as penyelia_projek1 ON `penyelia_projek1`.`id`=`jpd_khas`.`penyelia_projek` "
				],
				'Status' => [
					'parent-table' => 'status_pelaksanaan',
					'parent-primary-key' => 'id',
					'child-primary-key' => 'ID',
					'child-primary-key-index' => 0,
					'tab-label' => 'JPD PRE <span class="hidden child-label-jpd_khas child-field-caption">(Status)</span>',
					'auto-close' => false,
					'table-icon' => 'resources/table_icons/car.png',
					'display-refresh' => true,
					'display-add-new' => true,
					'forced-where' => '',
					'display-fields' => array(1 => 'Tahun laksana', 2 => 'Sumber Peruntukan', 3 => 'Kelulusan', 4 => 'Nama Projek', 5 => 'Negeri', 6 => 'Daerah', 7 => 'Parlimen', 8 => 'DUN', 11 => 'Nama Kontraktor', 12 => 'Tarikh SST ', 14 => 'Tarikh Siap Sebenar', 15 => 'Panjang Jalan (M)', 16 => 'Lebar (M)', 17 => 'Skop Kerja', 18 => 'Gambar ', 20 => 'Peta', 21 => 'Peruntukan Diluluskan', 23 => 'Kos projek', 24 => 'KKSVO', 25 => 'Perbelanjaan', 26 => 'penjimatan', 27 => 'Status', 28 => 'Penyelia projek', 29 => 'Penerima Manfaat', 31 => 'Catatan', 32 => 'Inden Kerja', 33 => 'Baucer Bayaran', 34 => 'Gambar   ', 35 => 'Gambar projek', 36 => 'Dikemaskini Oleh'),
					'display-field-names' => array(1 => 'tahun_laksana', 2 => 'Waran', 3 => 'Kelulusan', 4 => 'NamaProjek', 5 => 'negeri', 6 => 'Daerah', 7 => 'Parlimen', 8 => 'DUN', 11 => 'NamaKontraktor', 12 => 'TarikhSST', 14 => 'TarikhSiapsebenar', 15 => 'PanjangJalanM', 16 => 'LebarM', 17 => 'skop', 18 => 'gambar_projek', 20 => 'Peta', 21 => 'PeruntukanDiluluskan', 23 => 'Kosprojek', 24 => 'KKSVO', 25 => 'Perbelanjaan', 26 => 'penjimatan', 27 => 'Status', 28 => 'penyelia_projek', 29 => 'PenerimaManfaat', 31 => 'catatan', 32 => 'inden', 33 => 'Baucer', 34 => 'gambar_projek_1', 35 => 'gambar_projek_2', 36 => 'updated'),
					'sortable-fields' => array(0 => '`jpd_khas`.`ID`', 1 => '`tahun1`.`tahun`', 2 => '`waran1`.`sumber_waran`', 3 => '`kelulusan1`.`kelulusan_jawatankuasa`', 4 => 5, 5 => '`negeri1`.`nama_negeri`', 6 => '`daerah1`.`nama_daerah`', 7 => '`PARLIMEN1`.`nama_parlimen`', 8 => '`Dun1`.`nama_dun`', 9 => '`agensi_pelaksana1`.`pelaksana`', 10 => '`agensi_bayar1`.`agensi`', 11 => 12, 12 => '`jpd_khas`.`TarikhSST`', 13 => '`jpd_khas`.`TarikhSiapProjek`', 14 => 15, 15 => '`jpd_khas`.`PanjangJalanM`', 16 => 17, 17 => '`skop_jpd1`.`skop_jpd`', 18 => 19, 19 => 20, 20 => 21, 21 => '`jpd_khas`.`PeruntukanDiluluskan`', 22 => '`jpd_khas`.`peruntukan_dipinda`', 23 => '`jpd_khas`.`Kosprojek`', 24 => '`jpd_khas`.`KKSVO`', 25 => '`jpd_khas`.`Perbelanjaan`', 26 => '`jpd_khas`.`penjimatan`', 27 => '`status_pelaksanaan1`.`status_laksana`', 28 => '`penyelia_projek1`.`nama_penyelia`', 29 => 30, 30 => 31, 31 => 32, 32 => 33, 33 => 34, 34 => 35, 35 => 36, 36 => 37),
					'records-per-page' => 10,
					'default-sort-by' => 0,
					'default-sort-direction' => 'asc',
					'open-detail-view-on-click' => true,
					'display-page-selector' => true,
					'show-page-progress' => true,
					'template' => 'children-jpd_khas',
					'template-printable' => 'children-jpd_khas-printable',
					'query' => "SELECT `jpd_khas`.`ID` as 'ID', IF(    CHAR_LENGTH(`tahun1`.`tahun`), CONCAT_WS('',   `tahun1`.`tahun`), '') as 'tahun_laksana', IF(    CHAR_LENGTH(`waran1`.`sumber_waran`), CONCAT_WS('',   `waran1`.`sumber_waran`), '') as 'Waran', IF(    CHAR_LENGTH(`kelulusan1`.`kelulusan_jawatankuasa`), CONCAT_WS('',   `kelulusan1`.`kelulusan_jawatankuasa`), '') as 'Kelulusan', `jpd_khas`.`NamaProjek` as 'NamaProjek', IF(    CHAR_LENGTH(`negeri1`.`nama_negeri`), CONCAT_WS('',   `negeri1`.`nama_negeri`), '') as 'negeri', IF(    CHAR_LENGTH(`daerah1`.`nama_daerah`), CONCAT_WS('',   `daerah1`.`nama_daerah`), '') as 'Daerah', IF(    CHAR_LENGTH(`PARLIMEN1`.`nama_parlimen`), CONCAT_WS('',   `PARLIMEN1`.`nama_parlimen`), '') as 'Parlimen', IF(    CHAR_LENGTH(`Dun1`.`nama_dun`), CONCAT_WS('',   `Dun1`.`nama_dun`), '') as 'DUN', IF(    CHAR_LENGTH(`agensi_pelaksana1`.`pelaksana`), CONCAT_WS('',   `agensi_pelaksana1`.`pelaksana`), '') as 'AgensiPelaksana', IF(    CHAR_LENGTH(`agensi_bayar1`.`agensi`), CONCAT_WS('',   `agensi_bayar1`.`agensi`), '') as 'agensi_pembayar', `jpd_khas`.`NamaKontraktor` as 'NamaKontraktor', if(`jpd_khas`.`TarikhSST`,date_format(`jpd_khas`.`TarikhSST`,'%d/%m/%Y'),'') as 'TarikhSST', if(`jpd_khas`.`TarikhSiapProjek`,date_format(`jpd_khas`.`TarikhSiapProjek`,'%d/%m/%Y'),'') as 'TarikhSiapProjek', `jpd_khas`.`TarikhSiapsebenar` as 'TarikhSiapsebenar', `jpd_khas`.`PanjangJalanM` as 'PanjangJalanM', `jpd_khas`.`LebarM` as 'LebarM', IF(    CHAR_LENGTH(`skop_jpd1`.`skop_jpd`), CONCAT_WS('',   `skop_jpd1`.`skop_jpd`), '') as 'skop', `jpd_khas`.`gambar_projek` as 'gambar_projek', `jpd_khas`.`Latitud` as 'Latitud', `jpd_khas`.`Peta` as 'Peta', FORMAT(`jpd_khas`.`PeruntukanDiluluskan`, 2) as 'PeruntukanDiluluskan', `jpd_khas`.`peruntukan_dipinda` as 'peruntukan_dipinda', FORMAT(`jpd_khas`.`Kosprojek`, 2) as 'Kosprojek', FORMAT(`jpd_khas`.`KKSVO`, 2) as 'KKSVO', `jpd_khas`.`Perbelanjaan` as 'Perbelanjaan', `jpd_khas`.`penjimatan` as 'penjimatan', IF(    CHAR_LENGTH(`status_pelaksanaan1`.`status_laksana`), CONCAT_WS('',   `status_pelaksanaan1`.`status_laksana`), '') as 'Status', IF(    CHAR_LENGTH(`penyelia_projek1`.`nama_penyelia`), CONCAT_WS('',   `penyelia_projek1`.`nama_penyelia`), '') as 'penyelia_projek', `jpd_khas`.`PenerimaManfaat` as 'PenerimaManfaat', `jpd_khas`.`sumber_permohonan` as 'sumber_permohonan', `jpd_khas`.`catatan` as 'catatan', `jpd_khas`.`inden` as 'inden', `jpd_khas`.`Baucer` as 'Baucer', `jpd_khas`.`gambar_projek_1` as 'gambar_projek_1', `jpd_khas`.`gambar_projek_2` as 'gambar_projek_2', `jpd_khas`.`updated` as 'updated' FROM `jpd_khas` LEFT JOIN `tahun` as tahun1 ON `tahun1`.`id`=`jpd_khas`.`tahun_laksana` LEFT JOIN `waran` as waran1 ON `waran1`.`id`=`jpd_khas`.`Waran` LEFT JOIN `kelulusan` as kelulusan1 ON `kelulusan1`.`id`=`jpd_khas`.`Kelulusan` LEFT JOIN `negeri` as negeri1 ON `negeri1`.`id`=`jpd_khas`.`negeri` LEFT JOIN `daerah` as daerah1 ON `daerah1`.`id`=`jpd_khas`.`Daerah` LEFT JOIN `PARLIMEN` as PARLIMEN1 ON `PARLIMEN1`.`id`=`jpd_khas`.`Parlimen` LEFT JOIN `Dun` as Dun1 ON `Dun1`.`id`=`jpd_khas`.`DUN` LEFT JOIN `agensi_pelaksana` as agensi_pelaksana1 ON `agensi_pelaksana1`.`id`=`jpd_khas`.`AgensiPelaksana` LEFT JOIN `agensi_bayar` as agensi_bayar1 ON `agensi_bayar1`.`id`=`jpd_khas`.`agensi_pembayar` LEFT JOIN `skop_jpd` as skop_jpd1 ON `skop_jpd1`.`id`=`jpd_khas`.`skop` LEFT JOIN `status_pelaksanaan` as status_pelaksanaan1 ON `status_pelaksanaan1`.`id`=`jpd_khas`.`Status` LEFT JOIN `penyelia_projek` as penyelia_projek1 ON `penyelia_projek1`.`id`=`jpd_khas`.`penyelia_projek` "
				],
				'penyelia_projek' => [
					'parent-table' => 'penyelia_projek',
					'parent-primary-key' => 'id',
					'child-primary-key' => 'ID',
					'child-primary-key-index' => 0,
					'tab-label' => 'JPD PRE <span class="hidden child-label-jpd_khas child-field-caption">(Penyelia projek)</span>',
					'auto-close' => false,
					'table-icon' => 'resources/table_icons/car.png',
					'display-refresh' => true,
					'display-add-new' => true,
					'forced-where' => '',
					'display-fields' => array(1 => 'Tahun laksana', 2 => 'Sumber Peruntukan', 3 => 'Kelulusan', 4 => 'Nama Projek', 5 => 'Negeri', 6 => 'Daerah', 7 => 'Parlimen', 8 => 'DUN', 11 => 'Nama Kontraktor', 12 => 'Tarikh SST ', 14 => 'Tarikh Siap Sebenar', 15 => 'Panjang Jalan (M)', 16 => 'Lebar (M)', 17 => 'Skop Kerja', 18 => 'Gambar ', 20 => 'Peta', 21 => 'Peruntukan Diluluskan', 23 => 'Kos projek', 24 => 'KKSVO', 25 => 'Perbelanjaan', 26 => 'penjimatan', 27 => 'Status', 28 => 'Penyelia projek', 29 => 'Penerima Manfaat', 31 => 'Catatan', 32 => 'Inden Kerja', 33 => 'Baucer Bayaran', 34 => 'Gambar   ', 35 => 'Gambar projek', 36 => 'Dikemaskini Oleh'),
					'display-field-names' => array(1 => 'tahun_laksana', 2 => 'Waran', 3 => 'Kelulusan', 4 => 'NamaProjek', 5 => 'negeri', 6 => 'Daerah', 7 => 'Parlimen', 8 => 'DUN', 11 => 'NamaKontraktor', 12 => 'TarikhSST', 14 => 'TarikhSiapsebenar', 15 => 'PanjangJalanM', 16 => 'LebarM', 17 => 'skop', 18 => 'gambar_projek', 20 => 'Peta', 21 => 'PeruntukanDiluluskan', 23 => 'Kosprojek', 24 => 'KKSVO', 25 => 'Perbelanjaan', 26 => 'penjimatan', 27 => 'Status', 28 => 'penyelia_projek', 29 => 'PenerimaManfaat', 31 => 'catatan', 32 => 'inden', 33 => 'Baucer', 34 => 'gambar_projek_1', 35 => 'gambar_projek_2', 36 => 'updated'),
					'sortable-fields' => array(0 => '`jpd_khas`.`ID`', 1 => '`tahun1`.`tahun`', 2 => '`waran1`.`sumber_waran`', 3 => '`kelulusan1`.`kelulusan_jawatankuasa`', 4 => 5, 5 => '`negeri1`.`nama_negeri`', 6 => '`daerah1`.`nama_daerah`', 7 => '`PARLIMEN1`.`nama_parlimen`', 8 => '`Dun1`.`nama_dun`', 9 => '`agensi_pelaksana1`.`pelaksana`', 10 => '`agensi_bayar1`.`agensi`', 11 => 12, 12 => '`jpd_khas`.`TarikhSST`', 13 => '`jpd_khas`.`TarikhSiapProjek`', 14 => 15, 15 => '`jpd_khas`.`PanjangJalanM`', 16 => 17, 17 => '`skop_jpd1`.`skop_jpd`', 18 => 19, 19 => 20, 20 => 21, 21 => '`jpd_khas`.`PeruntukanDiluluskan`', 22 => '`jpd_khas`.`peruntukan_dipinda`', 23 => '`jpd_khas`.`Kosprojek`', 24 => '`jpd_khas`.`KKSVO`', 25 => '`jpd_khas`.`Perbelanjaan`', 26 => '`jpd_khas`.`penjimatan`', 27 => '`status_pelaksanaan1`.`status_laksana`', 28 => '`penyelia_projek1`.`nama_penyelia`', 29 => 30, 30 => 31, 31 => 32, 32 => 33, 33 => 34, 34 => 35, 35 => 36, 36 => 37),
					'records-per-page' => 10,
					'default-sort-by' => 0,
					'default-sort-direction' => 'asc',
					'open-detail-view-on-click' => true,
					'display-page-selector' => true,
					'show-page-progress' => true,
					'template' => 'children-jpd_khas',
					'template-printable' => 'children-jpd_khas-printable',
					'query' => "SELECT `jpd_khas`.`ID` as 'ID', IF(    CHAR_LENGTH(`tahun1`.`tahun`), CONCAT_WS('',   `tahun1`.`tahun`), '') as 'tahun_laksana', IF(    CHAR_LENGTH(`waran1`.`sumber_waran`), CONCAT_WS('',   `waran1`.`sumber_waran`), '') as 'Waran', IF(    CHAR_LENGTH(`kelulusan1`.`kelulusan_jawatankuasa`), CONCAT_WS('',   `kelulusan1`.`kelulusan_jawatankuasa`), '') as 'Kelulusan', `jpd_khas`.`NamaProjek` as 'NamaProjek', IF(    CHAR_LENGTH(`negeri1`.`nama_negeri`), CONCAT_WS('',   `negeri1`.`nama_negeri`), '') as 'negeri', IF(    CHAR_LENGTH(`daerah1`.`nama_daerah`), CONCAT_WS('',   `daerah1`.`nama_daerah`), '') as 'Daerah', IF(    CHAR_LENGTH(`PARLIMEN1`.`nama_parlimen`), CONCAT_WS('',   `PARLIMEN1`.`nama_parlimen`), '') as 'Parlimen', IF(    CHAR_LENGTH(`Dun1`.`nama_dun`), CONCAT_WS('',   `Dun1`.`nama_dun`), '') as 'DUN', IF(    CHAR_LENGTH(`agensi_pelaksana1`.`pelaksana`), CONCAT_WS('',   `agensi_pelaksana1`.`pelaksana`), '') as 'AgensiPelaksana', IF(    CHAR_LENGTH(`agensi_bayar1`.`agensi`), CONCAT_WS('',   `agensi_bayar1`.`agensi`), '') as 'agensi_pembayar', `jpd_khas`.`NamaKontraktor` as 'NamaKontraktor', if(`jpd_khas`.`TarikhSST`,date_format(`jpd_khas`.`TarikhSST`,'%d/%m/%Y'),'') as 'TarikhSST', if(`jpd_khas`.`TarikhSiapProjek`,date_format(`jpd_khas`.`TarikhSiapProjek`,'%d/%m/%Y'),'') as 'TarikhSiapProjek', `jpd_khas`.`TarikhSiapsebenar` as 'TarikhSiapsebenar', `jpd_khas`.`PanjangJalanM` as 'PanjangJalanM', `jpd_khas`.`LebarM` as 'LebarM', IF(    CHAR_LENGTH(`skop_jpd1`.`skop_jpd`), CONCAT_WS('',   `skop_jpd1`.`skop_jpd`), '') as 'skop', `jpd_khas`.`gambar_projek` as 'gambar_projek', `jpd_khas`.`Latitud` as 'Latitud', `jpd_khas`.`Peta` as 'Peta', FORMAT(`jpd_khas`.`PeruntukanDiluluskan`, 2) as 'PeruntukanDiluluskan', `jpd_khas`.`peruntukan_dipinda` as 'peruntukan_dipinda', FORMAT(`jpd_khas`.`Kosprojek`, 2) as 'Kosprojek', FORMAT(`jpd_khas`.`KKSVO`, 2) as 'KKSVO', `jpd_khas`.`Perbelanjaan` as 'Perbelanjaan', `jpd_khas`.`penjimatan` as 'penjimatan', IF(    CHAR_LENGTH(`status_pelaksanaan1`.`status_laksana`), CONCAT_WS('',   `status_pelaksanaan1`.`status_laksana`), '') as 'Status', IF(    CHAR_LENGTH(`penyelia_projek1`.`nama_penyelia`), CONCAT_WS('',   `penyelia_projek1`.`nama_penyelia`), '') as 'penyelia_projek', `jpd_khas`.`PenerimaManfaat` as 'PenerimaManfaat', `jpd_khas`.`sumber_permohonan` as 'sumber_permohonan', `jpd_khas`.`catatan` as 'catatan', `jpd_khas`.`inden` as 'inden', `jpd_khas`.`Baucer` as 'Baucer', `jpd_khas`.`gambar_projek_1` as 'gambar_projek_1', `jpd_khas`.`gambar_projek_2` as 'gambar_projek_2', `jpd_khas`.`updated` as 'updated' FROM `jpd_khas` LEFT JOIN `tahun` as tahun1 ON `tahun1`.`id`=`jpd_khas`.`tahun_laksana` LEFT JOIN `waran` as waran1 ON `waran1`.`id`=`jpd_khas`.`Waran` LEFT JOIN `kelulusan` as kelulusan1 ON `kelulusan1`.`id`=`jpd_khas`.`Kelulusan` LEFT JOIN `negeri` as negeri1 ON `negeri1`.`id`=`jpd_khas`.`negeri` LEFT JOIN `daerah` as daerah1 ON `daerah1`.`id`=`jpd_khas`.`Daerah` LEFT JOIN `PARLIMEN` as PARLIMEN1 ON `PARLIMEN1`.`id`=`jpd_khas`.`Parlimen` LEFT JOIN `Dun` as Dun1 ON `Dun1`.`id`=`jpd_khas`.`DUN` LEFT JOIN `agensi_pelaksana` as agensi_pelaksana1 ON `agensi_pelaksana1`.`id`=`jpd_khas`.`AgensiPelaksana` LEFT JOIN `agensi_bayar` as agensi_bayar1 ON `agensi_bayar1`.`id`=`jpd_khas`.`agensi_pembayar` LEFT JOIN `skop_jpd` as skop_jpd1 ON `skop_jpd1`.`id`=`jpd_khas`.`skop` LEFT JOIN `status_pelaksanaan` as status_pelaksanaan1 ON `status_pelaksanaan1`.`id`=`jpd_khas`.`Status` LEFT JOIN `penyelia_projek` as penyelia_projek1 ON `penyelia_projek1`.`id`=`jpd_khas`.`penyelia_projek` "
				],
			],
			'pams_khas' => [
			],
			'jpd_noc' => [
			],
			'pams_noc' => [
			],
			'balb' => [
			],
			'JALB' => [
			],
			'BELB' => [
			],
			'pprt' => [
			],
			'ljk' => [
			],
			'pemohon_jpd' => [
			],
			'pams_mohon' => [
			],
			'pemohon_pprt' => [
			],
			'negeri' => [
			],
			'daerah' => [
			],
			'Dun' => [
			],
			'PARLIMEN' => [
			],
			'kelulusan' => [
			],
			'status_pelaksanaan' => [
			],
			'status_kelulusan_jpd' => [
				'pemohon' => [
					'parent-table' => 'pemohon_jpd',
					'parent-primary-key' => 'ID',
					'child-primary-key' => 'id',
					'child-primary-key-index' => 0,
					'tab-label' => 'Status kelulusan permohonan <span class="hidden child-label-status_kelulusan_jpd child-field-caption">(Pemohon)</span>',
					'auto-close' => false,
					'table-icon' => 'table.gif',
					'display-refresh' => true,
					'display-add-new' => true,
					'forced-where' => '',
					'display-fields' => array(1 => 'Pemohon', 2 => 'Kelulusan', 3 => 'tarikh_kelulusan', 4 => 'Pelulus'),
					'display-field-names' => array(1 => 'pemohon', 2 => 'kelulusan', 3 => 'tarikh_kelulusan', 4 => 'pelulus'),
					'sortable-fields' => array(0 => '`status_kelulusan_jpd`.`id`', 1 => 2, 2 => 3, 3 => '`status_kelulusan_jpd`.`tarikh_kelulusan`', 4 => 5),
					'records-per-page' => 10,
					'default-sort-by' => false,
					'default-sort-direction' => 'asc',
					'open-detail-view-on-click' => true,
					'display-page-selector' => true,
					'show-page-progress' => true,
					'template' => 'children-status_kelulusan_jpd',
					'template-printable' => 'children-status_kelulusan_jpd-printable',
					'query' => "SELECT `status_kelulusan_jpd`.`id` as 'id', IF(    CHAR_LENGTH(`pemohon_jpd1`.`Nama_Projek`) || CHAR_LENGTH(`pemohon_jpd1`.`anggaran_kos`), CONCAT_WS('',   `pemohon_jpd1`.`Nama_Projek`, '- RM', `pemohon_jpd1`.`anggaran_kos`), '') as 'pemohon', `status_kelulusan_jpd`.`kelulusan` as 'kelulusan', if(`status_kelulusan_jpd`.`tarikh_kelulusan`,date_format(`status_kelulusan_jpd`.`tarikh_kelulusan`,'%d/%m/%Y %h:%i %p'),'') as 'tarikh_kelulusan', `status_kelulusan_jpd`.`pelulus` as 'pelulus' FROM `status_kelulusan_jpd` LEFT JOIN `pemohon_jpd` as pemohon_jpd1 ON `pemohon_jpd1`.`ID`=`status_kelulusan_jpd`.`pemohon` "
				],
			],
			'status_kelulusan_pams' => [
			],
			'status_kelulusan_pprt' => [
			],
			'tahun' => [
			],
			'penyelia_projek' => [
			],
			'agensi_pelaksana' => [
			],
			'agensi_bayar' => [
			],
			'waran' => [
			],
			'jpd_de_REKOD' => [
			],
			'pams_DE_REKOD' => [
			],
			'jpd_test' => [
			],
			'skop_jpd' => [
			],
			'skop_pams' => [
			],
			'Syarikat' => [
			],
			'Syarikat_baru' => [
			],
			'ekasih' => [
			],
			'BLACKLIST' => [
			],
			'LJK_JENIS' => [
			],
			'Laporan_N9_fiz' => [
			],
			'Kew_n9' => [
			],
			'Laporan_MLK_fiz' => [
			],
			'Kew_MLK' => [
			],
		];

	/*************************************/
	/* End of configuration */


	$currDir = dirname(__FILE__);
	include_once("{$currDir}/lib.php");
	@header('Content-Type: text/html; charset=' . datalist_db_encoding);

	handle_maintenance();

	/**
	* dynamic configuration based on current user's permissions
	* $userPCConfig array is populated only with parent tables where the user has access to
	* at least one child table
	*/
	$userPCConfig = [];
	foreach($pcConfig as $pcChildTable => $ChildrenLookups) {
		$permChild = getTablePermissions($pcChildTable);
		if(!$permChild['view']) continue;

		foreach($ChildrenLookups as $ChildLookupField => $ChildConfig) {
			$permParent = getTablePermissions($ChildConfig['parent-table']);
			if(!$permParent['view']) continue;

			$userPCConfig[$pcChildTable][$ChildLookupField] = $pcConfig[$pcChildTable][$ChildLookupField];
			// show add new only if configured above AND the user has insert permission
			$userPCConfig[$pcChildTable][$ChildLookupField]['display-add-new'] = ($permChild['insert'] && $pcConfig[$pcChildTable][$ChildLookupField]['display-add-new']);
		}
	}

	/* Receive, UTF-convert, and validate parameters */
	$ParentTable = $_REQUEST['ParentTable']; // needed only with operation=show-children, will be validated in the processing code
	$ChildTable = $_REQUEST['ChildTable'];
		if(!in_array($ChildTable, array_keys($userPCConfig))) {
			/* defaults to first child table in config array if not provided */
			$ChildTable = current(array_keys($userPCConfig));
		}
		if(!$ChildTable) { die('<!-- No tables accessible to current user -->'); }
	$SelectedID = strip_tags($_REQUEST['SelectedID']);
	$ChildLookupField = $_REQUEST['ChildLookupField'];
		if(!in_array($ChildLookupField, array_keys($userPCConfig[$ChildTable]))) {
			/* defaults to first lookup in current child config array if not provided */
			$ChildLookupField = current(array_keys($userPCConfig[$ChildTable]));
		}
	$Page = intval($_REQUEST['Page']);
		if($Page < 1) {
			$Page = 1;
		}
	$SortBy = ($_REQUEST['SortBy'] != '' ? abs(intval($_REQUEST['SortBy'])) : false);
		if(!in_array($SortBy, array_keys($userPCConfig[$ChildTable][$ChildLookupField]['sortable-fields']), true)) {
			$SortBy = $userPCConfig[$ChildTable][$ChildLookupField]['default-sort-by'];
		}
	$SortDirection = strtolower($_REQUEST['SortDirection']);
		if(!in_array($SortDirection, array('asc', 'desc'))) {
			$SortDirection = $userPCConfig[$ChildTable][$ChildLookupField]['default-sort-direction'];
		}
	$Operation = strtolower($_REQUEST['Operation']);
		if(!in_array($Operation, array('get-records', 'show-children', 'get-records-printable', 'show-children-printable'))) {
			$Operation = 'get-records';
		}

	/* process requested operation */
	switch($Operation) {
		/************************************************/
		case 'show-children':
			/* populate HTML and JS content with children tabs */
			$tabLabels = $tabPanels = $tabLoaders = '';
			foreach($userPCConfig as $ChildTable => $childLookups) {
				foreach($childLookups as $ChildLookupField => $childConfig) {
					if($childConfig['parent-table'] == $ParentTable) {
						$TableIcon = ($childConfig['table-icon'] ? "<img src=\"{$childConfig['table-icon']}\" border=\"0\">" : '');
						$tabLabels .= sprintf('<li class="child-tab-label child-table-%s lookup-field-%s %s"><a href="#panel_%s-%s" id="tab_%s-%s" data-toggle="tab">%s%s</a></li>' . "\n\t\t\t\t\t", $ChildTable, $ChildLookupField, ($tabLabels ? '' : 'active'), $ChildTable, $ChildLookupField, $ChildTable, $ChildLookupField, $TableIcon, $childConfig['tab-label']);
						$tabPanels .= sprintf('<div id="panel_%s-%s" class="tab-pane%s"><i class="glyphicon glyphicon-refresh loop-rotate"></i> %s</div>' . "\n\t\t\t\t", $ChildTable, $ChildLookupField, ($tabPanels ? '' : ' active'), $Translation['Loading ...']);
						$tabLoaders .= sprintf('post("parent-children.php", { ChildTable: "%s", ChildLookupField: "%s", SelectedID: "%s", Page: 1, SortBy: "", SortDirection: "", Operation: "get-records" }, "panel_%s-%s");' . "\n\t\t\t\t", $ChildTable, $ChildLookupField, addslashes($SelectedID), $ChildTable, $ChildLookupField);
					}
				}
			}

			if(!$tabLabels) { die('<!-- no children of current parent table are accessible to current user -->'); }
			?>
			<div id="children-tabs">
				<ul class="nav nav-tabs">
					<?php echo $tabLabels; ?>
				</ul>
				<span id="pc-loading"></span>
			</div>
			<div class="tab-content"><?php echo $tabPanels; ?></div>

			<script>
				$j(function() {
					/* for iOS, avoid loading child tabs in modals */
					var iOS = /(iPad|iPhone|iPod)/g.test(navigator.userAgent);
					var embedded = ($j('.navbar').length == 0);
					if(iOS && embedded) {
						$j('#children-tabs').next('.tab-content').remove();
						$j('#children-tabs').remove();
						return;
					}

					/* ajax loading of each tab's contents */
					<?php echo $tabLoaders; ?>

					/* show child field caption on tab title in case the same child table appears more than once */
					$j('.child-field-caption').each(function() {
						var clss = $j(this).attr('class').split(/\s+/).reduce(function(rc, cc) {
							return (cc.match(/child-label-.*/) ? '.' + cc : rc);
						}, '');

						// if class occurs more than once, remove .hidden
						if($j(clss).length > 1) $j(clss).removeClass('hidden');
					})
				})
			</script>
			<?php
			break;

		/************************************************/
		case 'show-children-printable':
			/* populate HTML and JS content with children buttons */
			$tabLabels = $tabPanels = $tabLoaders = '';
			foreach($userPCConfig as $ChildTable => $childLookups) {
				foreach($childLookups as $ChildLookupField => $childConfig) {
					if($childConfig['parent-table'] == $ParentTable) {
						$TableIcon = ($childConfig['table-icon'] ? "<img src=\"{$childConfig['table-icon']}\" border=\"0\">" : '');
						$tabLabels .= sprintf('<button type="button" class="btn btn-default child-tab-print-toggler" data-target="#panel_%s-%s" id="tab_%s-%s" data-toggle="collapse">%s %s</button>' . "\n\t\t\t\t\t", $ChildTable, $ChildLookupField, $ChildTable, $ChildLookupField, $TableIcon, $childConfig['tab-label']);
						$tabPanels .= sprintf('<div id="panel_%s-%s" class="collapse child-panel-print"><i class="glyphicon glyphicon-refresh loop-rotate"></i> %s</div>' . "\n\t\t\t\t", $ChildTable, $ChildLookupField, $Translation['Loading ...']);
						$tabLoaders .= sprintf('post("parent-children.php", { ChildTable: "%s", ChildLookupField: "%s", SelectedID: "%s", Page: 1, SortBy: "", SortDirection: "", Operation: "get-records-printable" }, "panel_%s-%s");' . "\n\t\t\t\t", $ChildTable, $ChildLookupField, addslashes($SelectedID), $ChildTable, $ChildLookupField);
					}
				}
			}

			if(!$tabLabels) { die('<!-- no children of current parent table are accessible to current user -->'); }
			?>
			<div id="children-tabs" class="hidden-print">
				<div class="btn-group btn-group-lg">
					<?php echo $tabLabels; ?>
				</div>
				<span id="pc-loading"></span>
			</div>
			<div class="vspacer-lg"><?php echo $tabPanels; ?></div>

			<script>
				$j(function() {
					/* for iOS, avoid loading child tabs in modals */
					var iOS = /(iPad|iPhone|iPod)/g.test(navigator.userAgent);
					var embedded = ($j('.navbar').length == 0);
					if(iOS && embedded) {
						$j('#children-tabs').next('.tab-content').remove();
						$j('#children-tabs').remove();
						return;
					}

					/* ajax loading of each tab's contents */
					<?php echo $tabLoaders; ?>
				})
			</script>
			<?php
			break;

		/************************************************/
		case 'get-records-printable':
		default: /* default is 'get-records' */

			if($Operation == 'get-records-printable') {
				$userPCConfig[$ChildTable][$ChildLookupField]['records-per-page'] = 2000;
			}

			// build the user permissions limiter
			$permissionsWhere = $permissionsJoin = '';
			$permChild = getTablePermissions($ChildTable);
			if($permChild['view'] == 1) { // user can view only his own records
				$permissionsWhere = "`$ChildTable`.`{$userPCConfig[$ChildTable][$ChildLookupField]['child-primary-key']}`=`membership_userrecords`.`pkValue` AND `membership_userrecords`.`tableName`='$ChildTable' AND LCASE(`membership_userrecords`.`memberID`)='" . getLoggedMemberID() . "'";
			} elseif($permChild['view'] == 2) { // user can view only his group's records
				$permissionsWhere = "`$ChildTable`.`{$userPCConfig[$ChildTable][$ChildLookupField]['child-primary-key']}`=`membership_userrecords`.`pkValue` AND `membership_userrecords`.`tableName`='$ChildTable' AND `membership_userrecords`.`groupID`='" . getLoggedGroupID() . "'";
			} elseif($permChild['view'] == 3) { // user can view all records
				/* that's the only case remaining ... no need to modify the query in this case */
			}
			$permissionsJoin = ($permissionsWhere ? ", `membership_userrecords`" : '');

			// build the count query
			$forcedWhere = $userPCConfig[$ChildTable][$ChildLookupField]['forced-where'];
			$query = 
				preg_replace('/^select .* from /i', 'SELECT count(1) FROM ', $userPCConfig[$ChildTable][$ChildLookupField]['query']) .
				$permissionsJoin . " WHERE " .
				($permissionsWhere ? "( $permissionsWhere )" : "( 1=1 )") . " AND " .
				($forcedWhere ? "( $forcedWhere )" : "( 2=2 )") . " AND " .
				"`$ChildTable`.`$ChildLookupField`='" . makeSafe($SelectedID) . "'";
			$totalMatches = sqlValue($query);

			// make sure $Page is <= max pages
			$maxPage = ceil($totalMatches / $userPCConfig[$ChildTable][$ChildLookupField]['records-per-page']);
			if($Page > $maxPage) { $Page = $maxPage; }

			// initiate output data array
			$data = array(
				'config' => $userPCConfig[$ChildTable][$ChildLookupField],
				'parameters' => array(
					'ChildTable' => $ChildTable,
					'ChildLookupField' => $ChildLookupField,
					'SelectedID' => $SelectedID,
					'Page' => $Page,
					'SortBy' => $SortBy,
					'SortDirection' => $SortDirection,
					'Operation' => $Operation
				),
				'records' => [],
				'totalMatches' => $totalMatches
			);

			// build the data query
			if($totalMatches) { // if we have at least one record, proceed with fetching data
				$startRecord = $userPCConfig[$ChildTable][$ChildLookupField]['records-per-page'] * ($Page - 1);
				$data['query'] = 
					$userPCConfig[$ChildTable][$ChildLookupField]['query'] .
					$permissionsJoin . " WHERE " .
					($permissionsWhere ? "( $permissionsWhere )" : "( 1=1 )") . " AND " .
					($forcedWhere ? "( $forcedWhere )" : "( 2=2 )") . " AND " .
					"`$ChildTable`.`$ChildLookupField`='" . makeSafe($SelectedID) . "'" . 
					($SortBy !== false && $userPCConfig[$ChildTable][$ChildLookupField]['sortable-fields'][$SortBy] ? " ORDER BY {$userPCConfig[$ChildTable][$ChildLookupField]['sortable-fields'][$SortBy]} $SortDirection" : '') .
					" LIMIT $startRecord, {$userPCConfig[$ChildTable][$ChildLookupField]['records-per-page']}";
				$res = sql($data['query'], $eo);
				while($row = db_fetch_row($res)) {
					$data['records'][$row[$userPCConfig[$ChildTable][$ChildLookupField]['child-primary-key-index']]] = $row;
				}
			} else { // if no matching records
				$startRecord = 0;
			}

			if($Operation == 'get-records-printable') {
				$response = loadView($userPCConfig[$ChildTable][$ChildLookupField]['template-printable'], $data);
			} else {
				$response = loadView($userPCConfig[$ChildTable][$ChildLookupField]['template'], $data);
			}

			// change name space to ensure uniqueness
			$uniqueNameSpace = $ChildTable.ucfirst($ChildLookupField).'GetRecords';
			echo str_replace("{$ChildTable}GetChildrenRecordsList", $uniqueNameSpace, $response);
		/************************************************/
	}
